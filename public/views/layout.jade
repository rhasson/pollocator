!!! 5
html(land="en")
  head
    title Pollocator - Find a polling station near you

    meta(name='viewport', content='width=device-width, initial-scale=1.0')

    script(type='text/javascript', src='/js/quo.js')'

    link(rel='stylesheet', href='/css/bootstrap.min.css')
    link(rel='stylesheet', href='/css/bootstrap-responsive.min.css')
    link(rel='stylesheet', href='/css/styles.css')

  body
    div#container.fluid.header
      section#responsive
        div.row-fluid
          div#header.span12
            h2 Poll Locator for U.S. General Election
        div.row-fluid.box1
          div#addr.span12.offset2.content.control-group
            div.controls
              div.span8
                input.input-xxlarge.address(type='text', name='address', placeholder='Enter your home address')
        div.row-fluid.box1
          div.span12.offset2
            div.span8
              button.btn.btn-primary(type='submit') Check
        div.row-fluid.box2
          div#list.span12.offset2.content
            div.span8.listItems
        div.row-fluid.box2
          div.span12.offset2.content
            div.span8.back

    script
      $$(document).ready(function(){
        $$('.btn').on('click', function(evt) {
          evt.preventDefault();

          $$('div#addr').removeClass('error');
          $$('input.address').on('focus', function() {
            $$('div#addr').removeClass('error');
          });

          var addr = $$('input.address').val();
          console.log(addr)
          $$.post('/poll', {address: addr}, function(data) {
          console.log(data);
            if (!data.error) {
              $$('div.box1').hide();
              
              //$$('div.listItems').append("<div class='span8'></div>");

              var t = '';
              data.pollingLocations.forEach(function(loc, i) {
                t = "<h6>"+loc.address.locationName+" " + 
                loc.address.line1.toLowerCase()+" " + 
                loc.address.city.toLowerCase() +
                "</h6>";
                $$('div.listItems').append(t);
              });

              $$('div.back').append("<span><a class='back_link' href='#'>Go Back</a></span>");
              $$('a.back_link').on('click', function() {
                $$('input.address').val('');
                $$('input.address').attr('placeholder', 'Enter your home address')
                $$('div.box2').hide();
                $$('div.box1').show();
                $$('div.listItems').empty();
                $$('div.back').empty();
              });

              $$('div.box2').show();
            } else {
              $$('div#addr').addClass('error');
              $$('input.address').val('').attr('placeholder', data.error);
            }
          });
        });
      });